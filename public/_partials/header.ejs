<header>
    <nav id="top-menu">
        <span>
            <img src="/assets/svg/admiralty-logo-full.svg" alt="Admiralty Marine Data Solutions | UK Hydrographic Office">
        </span>
    </nav>

    <nav id="main-menu">

        <div>
            <h1><%= mainHeading %></h1>
            <a href="#main-menu-toggle"
               id="main-menu-close"
               class="menu-close"
               aria-label="Close main menu">
                <span class="sr-only">Close main menu</span>
                <span class="fa fa-times"></span>
            </a>
        </div>

        <ul aria-label="<%= mainHeading %>">
            <%
                var currentFolder = typeof url !== 'undefined' ? url.split('/')[0] : '';
                for (var idx1 = 0; idx1 < folders.length; idx1++) {
                    var folder = folders[idx1];
                    var section = public[folder];
                    var sectionIndex = section._data.index;
                    if (!sectionIndex) {
                        console.error('Menu partial: No index page definition for section ' + JSON.stringify({ folder, data: section._data }));
                    }
                    var sectionTitle = sectionIndex.title;
                    var sectionMeta = section._data.meta;
                    var sectionHref = '/' + section._data.index.url;
            %>
            <li tabindex="0" <%- folder === currentFolder ? ' class="active"' : '' %>>
                <a tabindex="-1" href="<%= sectionHref + (folder !== currentFolder ? '#main-menu' : '') %>"><%= sectionTitle %></a>
                <section>
                    <%
                        for (var idx2 = 0; idx2 < sectionMeta.folders.length; idx2++) {
                            var subfolder = sectionMeta.folders[idx2];
                            var subsection = section[subfolder];
                            var subsectionIndex = subsection._data.index;
                            if (!subsectionIndex) {
                                console.error('Menu partial: No index page definition for subsection ' + JSON.stringify(subsection));
                            }
                            var subsectionTitle = subsectionIndex.title;
                            var subsectionHref = '/' + subsectionIndex.url;
                    %>
                    <section>
                        <h2><a href="<%= subsectionHref %>"><%= subsectionTitle %></a></h2>
                        <%
                            var pages = [];
                            for (var page in subsection._data) {
                                if (!subsection._data.hasOwnProperty(page) || page === 'index' || page === 'meta') continue;
                                var pageData = subsection._data[page];
                                pages.push({
                                    name: page,
                                    title: pageData.title,
                                    order: pageData.order || 99,
                                    url: '/' + (pageData.url || (subsectionHref + '/' + page)) + '.html'
                                });
                            }
                            if (pages.length > 0) {
                                pages.sort(function(a, b) {
                                    return a.order - b.order;
                                });
                        %>
                        <ul>
                            <%
                                for (var idx3 = 0; idx3 < pages.length; idx3++) {
                                    var menuItem = pages[idx3];
                            %>
                            <li>
                                <a href="<%= menuItem.url %>"><%= menuItem.title %></a>
                            </li>
                            <%
                                }
                            %>
                        </ul>
                        <%
                            }
                        %>
                    </section>
                    <%
                        }
                    %>
                </section>
            </li>
            <% } %>
        </ul>
    </nav>

    <a id="backdrop"
       href="#main-menu-toggle"
       class="backdrop"
       tabindex="-1"
       aria-hidden="true" hidden>
    </a>

    <div class="menu-toggle-wrapper">
        <h1><%= mainHeading %></h1>
        <a href="#main-menu" id="main-menu-toggle" class="menu-toggle">
            <span class="sr-only">Open main menu</span>
            <span class="fa fa-bars" aria-hidden="true"></span>
        </a>
    </div>

</header>
