name: 'Design System Release Packages'
description: 'Downloads build artifacts and releases them'
inputs:
  GITHUB_TOKEN:
    description: GITHUB_TOKEN used to create release
    required: true
  NPM_TOKEN:
    description: NPM_TOKEN used to publish to npm
    required: true
  ADMIN_TOKEN:
    description: ADMIN_TOKEN used to access the git repo
    required: true
runs:
  using: 'composite'
  steps:
    - uses: actions/checkout@v2
      with:
        token: ${{ inputs.ADMIN_TOKEN }}
    - name: Prepare repository
      run: git fetch --unshallow --tags
      shell: bash
    - uses: ./.github/workflows/actions/download-archive
      with:
        name: admiralty-core
        path: ./packages/core
        filename: admiralty-core.zip
    - uses: ./.github/workflows/actions/download-archive
      with:
        name: admiralty-angular
        path: ./packages/angular
        filename: admiralty-angular.zip
    - name: Create Release
      env:
        GITHUB_TOKEN: ${{ inputs.GITHUB_TOKEN }}
        NPM_TOKEN: ${{ inputs.NPM_TOKEN }}
        PROTECTED_BRANCH_REVIEWER_TOKEN: ${{ inputs.ADMIN_TOKEN }}
      run: |
        yarn install --immutable
        npx auto shipit
      shell: bash
